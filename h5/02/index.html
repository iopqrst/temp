<!DOCTYPE html>
<!-- saved from url=(0039)http://test.miaov.com/h5/1-3/index.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>妙味课堂-破茧成蝶</title>
<meta name="viewport" content="width=640,target-densityDpi=device-dpi, user-scalable=no">
<style>
*{ margin:0; padding:0;}
body{ font-family:Tahoma,Arial,Roboto,"Droid Sans","Helvetica Neue","Droid Sans Fallback","Heiti SC",sans-self; }
li{ list-style:none;}
#main{ width:640px; overflow:hidden; position:relative;}
#ul1{}
#ul1 > li{ width:100%; height:101%; background-repeat:no-repeat; background-size:cover; position:absolute; top:0; left:0; display:none; z-index:1;}
#ul1 > li.active{ z-index:2;}
#ul1 .li1Child{ width:100%; color:white; font-size:30px; position:absolute; left:100px; top:65%;}
#ul1 .li1Child li{ opacity:0;}
#ul1 .li1Child li:nth-of-type(odd){ -webkit-transform:translate(-150px,0); }
#ul1 .li1Child li:nth-of-type(even){ -webkit-transform:translate(250px,0);}
#ul1 li:nth-of-type(2) div{ position:absolute; width:90px; height:90px; left:275px; top:600px;}
#ul1 li:nth-of-type(2) div:nth-of-type(1).active{ top:29%; left:272px;}
#ul1 li:nth-of-type(2) div:nth-of-type(2).active{ top:43%; left:450px;}
#ul1 li:nth-of-type(2) div:nth-of-type(3).active{ top:64%; left:460px;}
#ul1 li:nth-of-type(2) div:nth-of-type(4).active{ top:76%; left:272px;}
#ul1 li:nth-of-type(2) div:nth-of-type(5).active{ top:64%; left:90px;}
#ul1 li:nth-of-type(2) div:nth-of-type(6).active{ top:43%; left:90px;}
#ul1 li:nth-of-type(3) div{ width:460px; height:222px; background:url(img/d1.png) no-repeat; position:absolute; left:96px; top:70%;}
#ul1 li:nth-of-type(4) div{ border:1px white solid; position:absolute;  -webkit-box-shadow:0px 0px 30px white; border-radius:5px; font-size:21px; color:white; word-wrap:break-word; padding:5px; width:0; height:0; overflow:hidden;}
#ul1 li:nth-of-type(4) div:nth-of-type(1).active{ width:182px; height:258px;}
#ul1 li:nth-of-type(4) div:nth-of-type(2).active{ width:307px; height:140px;}
#ul1 li:nth-of-type(4) div:nth-of-type(3).active{ width:96px; height:227px;}
#ul1 li:nth-of-type(4) div:nth-of-type(4).active{ width:233px; height:129px;}
#ul1 li:nth-of-type(4) div:nth-of-type(5).active{ width:166px; height:240px;}
#c1{position:absolute; left:0; top:0; z-index:10;}
#cImg{position:absolute; left:0; top:0; z-index:9; width:100%;height:100%;}
#arrow{ width:90px; height:52px; background:url(img/arr.png) no-repeat; position:absolute; bottom:50px; left:50%; margin-left:-45px; z-index:3; -webkit-transform: translate(0,42px); -webkit-animation:arrowTop 1.5s infinite;}
@-webkit-keyframes arrowTop{
	0%{-webkit-transform: translate(0,42px); opacity: 0;}
	60%{-webkit-transform: translate(0,12px); opacity: 1;}
	100%{-webkit-transform: translate(0,0); opacity: 0;}
}
#music{ width:55px; height:55px; background:url(img/music.png) no-repeat; position:absolute; top:20px; right:20px; z-index:3; background-size:cover;}
#music.run{-webkit-animation:musicRotate 1.5s infinite linear;}
@-webkit-keyframes musicRotate{
	from {-webkit-transform:rotate(0deg);}
	to {-webkit-transform:rotate(360deg);}
}
#loading{ width:100%; height:100%; background:white;position:absolute; left:0; top:0; z-index:20; color:#5fb336;}
#loading ul{ position:fixed; top:40%; left:50%; margin-left:-30px;}
#loading div{ position:fixed; top:50%; width:100%; text-align:center; font-size:40px;}
#loading ul li{ width:5px; height:50px; float:left; margin-right:5px; -webkit-animation:loadingRun 2s infinite;  background:#5fb336;}
@-webkit-keyframes loadingRun{
  0%, 80%, 100% { -webkit-transform: scaleY(1.0) }
  40% { -webkit-transform: scaleY(0.3) }
}
#loading ul li:nth-of-type(1){
  -webkit-animation-delay: -1.1s;
}
#loading ul li:nth-of-type(2){
  -webkit-animation-delay: -0.9s;
}
#loading ul li:nth-of-type(3){
  -webkit-animation-delay: -0.7s;
}
#loading ul li:nth-of-type(4){
  -webkit-animation-delay: -0.5s;
}
#loading ul li:nth-of-type(5){
  -webkit-animation-delay: -0.3s;
}
#loading ul li:nth-of-type(6){
  -webkit-animation-delay: -0.1s;
}
</style>
<script src="img/jquery-2.1.3.min.js"></script>
<script>
$(document).on('touchmove',
function(a) {
    a.preventDefault()
});
$(function() {
    var l = $(window).height();
    var m = $('#ul1').find('>li');
    $('#main').css('height', l);
    loadImg();
    slideCanvas();
    slideImg();
    function slideCanvas() {
        var h = $('#c1');
        var j = h.get(0).getContext('2d');
        h.attr('height', l);
        var k = new Image();
        k.src = 'img/a.png';
        var w = veiwFit();
        k.onload = function() {
            j.drawImage(k, (640 - w) / 2, 0, w, l);
            var r = 30;
            var g = true;
            j.lineWidth = r * 2;
            j.strokeStyle = 'red';
            j.lineCap = 'round';
            h.on('touchstart',
            function(e) {
                $("#cImg").css("display", "none");
                var f = e.originalEvent.changedTouches[0];
                var x = f.pageX - $(this).offset().left;
                var y = f.pageY - $(this).offset().top;
                if (g) {
                    j.globalCompositeOperation = 'destination-out';
                    j.moveTo(x, y);
                    j.lineTo(x + 1, y + 1);
                    j.stroke();
                    g = false
                } else {
                    j.lineTo(x, y);
                    j.stroke()
                }
                $(this).on('touchmove',
                function(a) {
                    var b = a.originalEvent.changedTouches[0];
                    var x = b.pageX - $(this).offset().left;
                    var y = b.pageY - $(this).offset().top;
                    j.lineTo(x, y);
                    j.stroke()
                });
                $(this).on('touchend',
                function(a) {
                    var b = j.getImageData(0, 0, 640, l);
                    var c = 640 * l;
                    var d = 0;
                    for (var i = 0; i < c; i++) {
                        if (b.data[4 * i + 3] == 0) {
                            d++
                        }
                    }
                    if (d > c / 2) {
                        h.animate({
                            opacity: 0
                        },
                        1000,
                        function() {
                            $(this).remove();
                            n[0].inAn()
                        });
                        musicShow()
                    }
                    $(this).off('touchmove');
                    $(this).off('touchend')
                })
            })
        }
    }
    function veiwFit() {
        var w = 640 * l / 960;
        w = w > 640 ? w: 640;
        return w
    }
    function slideImg() {
        var w = veiwFit();
        m.css({
            backgroundPosition: (640 - w) / 2 + 'px 0'
        });
        var f = 0;
        var g = 0.25;
        var h = 0;
        var i = 0;
        var j = true;
        m.on('touchstart',
        function(d) {
            if (j) {
                j = false;
                var e = d.originalEvent.changedTouches[0];
                f = e.pageY;
                h = $(this).index();
                $(this).on('touchmove.drag',
                function(a) {
                    var b = a.originalEvent.changedTouches[0];
                    var c = (b.pageY - f) * g;
                    if (b.pageY - f < 0) {
                        $(this).css('transform', 'translate(0,' + c + 'px) scale(' + (1 - Math.abs(c / l)) + ')');
                        i = h == m.length - 1 ? 0 : h + 1;
                        m.eq(i).css('transform', 'translate(0,' + (l + (b.pageY - f)) + 'px)');
                        m.eq(i).show().addClass('active')
                    } else if (b.pageY - f > 0) {
                        $(this).css('transform', 'translate(0,' + c + 'px) scale(' + (1 - Math.abs(c / l)) + ')');
                        i = h == 0 ? m.length - 1 : h - 1;
                        m.eq(i).css('transform', 'translate(0,' + ( - l + (b.pageY - f)) + 'px)');
                        m.eq(i).show().addClass('active')
                    }
                });
                $(this).on('touchend.drag',
                function(a) {
                    var b = a.originalEvent.changedTouches[0];
                    if (b.pageY - f < 0) {
                        $(this).css('transform', 'translate(0,' + -l * g + 'px) scale(' + (1 - g) + ')')
                    } else if (b.pageY - f > 0) {
                        $(this).css('transform', 'translate(0,' + l * g + 'px) scale(' + (1 - g) + ')')
                    }
                    $(this).css('transition', 'all .3s');
                    m.eq(i).css('transform', 'translate(0,0)');
                    m.eq(i).css('transition', 'all .3s');
                    $(this).off('.drag')
                })
            }
        });
        m.on('webkitTransitionEnd',
        function(a) {
            if (!m.is(a.target)) {
                return
            }
            resetFn();
            if (n[h]) {
                n[h].outAn()
            }
            if (n[i]) {
                n[i].inAn()
            }
        });
        function resetFn() {
            j = true;
            m.css('transition', '');
            m.css('transform', '');
            m.eq(i).removeClass('active').siblings().hide()
        }
    }
    var n = [{
        outAn: function() {
            var a = m.eq(0).find('li');
            a.css('opacity', 0);
            a.filter(':odd').css('transform', 'translate(-150px,0)');
            a.filter(':even').css('transform', 'translate(250px,0)')
        },
        inAn: function() {
            var a = m.eq(0).find('li');
            a.css('transform', 'translate(0,0)');
            a.css('opacity', 1);
            a.css('transition', 'all 1s')
        }
    },
    {
        outAn: function() {
            var a = m.eq(1).find('div');
            a.attr('class', '');
            a.css('transform', 'rotate(0)')
        },
        inAn: function() {
            var a = m.eq(1).find('div');
            a.attr('class', 'active');
            a.css('transform', 'rotate(720deg)');
            a.css('transition', 'all 1s')
        }
    },
    {
        outAn: function() {
            var a = m.eq(2).find('div');
            a.css('transform', 'rotateY(0)')
        },
        inAn: function() {
            var a = m.eq(2).find('div');
            a.css('transform', 'rotateY(360deg)');
            a.css('transition', 'all 1s')
        }
    },
    {
        outAn: function() {
            var a = m.eq(3).find('div');
            a.attr('class', '')
        },
        inAn: function() {
            var a = m.eq(3).find('div');
            a.attr('class', 'active');
            a.css('transition', 'all 1s')
        }
    }];
    function musicShow() {
        var a = $('#music').find('audio').get(0);
        a.play();
        $('#music').addClass('run');
        $('#music').on('touchstart',
        function() {
            if (a.paused) {
                a.play();
                $('#music').addClass('run')
            } else {
                a.pause();
                $('#music').removeClass('run')
            }
        })
    }
    function loadImg() {
        var c = ['a.png', 'b.png', 'c.png', 'd.png', 'e.png', 'ad1.png', 'ad2.png', 'ad3.png', 'ad4.png', 'arr.png', 'c1.png', 'c2.png', 'c3.png', 'c4.png', 'c5.png', 'c6.png', 'd1.png', 'music.png'];
        var d = 0;
        $.each(c,
        function(i, a) {
            var b = new Image();
            b.src = 'img/' + a;
            b.onload = function() {
                d++;
                if (d == c.length) {
                    $('#loading').animate({
                        opacity: 0
                    },
                    1000,
                    function() {
                        $(this).remove()
                    })
                }
            };
            b.error = function() {
                $('#loading').animate({
                    opacity: 0
                },
                1000,
                function() {
                    $(this).remove()
                })
            }
        })
    }
});
</script>
</head>

<body>
<img src="img/logo.jpg" style="position:absolute; top:-999px; left:-8888px;">
<div id="main" style="height: 960px;">
	
    <img src="img/a.png" id="cImg">
	<canvas id="c1" width="640" height="960"></canvas>
	<ul id="ul1">
    	<li style="display: block; background-image: url(http://test.miaov.com/h5/1-3/img/b.png); background-position: 0px 0px;">
        	<ul class="li1Child">
            	<li>
                	<p>曾经做为前端开发的你</p>
                    <p>解决PC兼容性而焦头烂额</p>
                </li>
                <li>
                	<p>而今</p>
                    <p>移动端H5应用疯狂来袭</p>
                </li>
                <li>
                	<p>你是否已准备充分</p>
                    <p>学习新技能</p>
                </li>
                <li>
                	<p>曾破茧成蝶、重获新生？</p>
                </li>
            </ul>
        </li>
        <li style="background-image: url(http://test.miaov.com/h5/1-3/img/c.png); background-position: 0px 0px;">
        	<div style="background:url(img/c1.png);"></div>
            <div style="background:url(img/c2.png);"></div>
            <div style="background:url(img/c3.png);"></div>
            <div style="background:url(img/c4.png);"></div>
            <div style="background:url(img/c5.png);"></div>
            <div style="background:url(img/c6.png);"></div>
        </li>
        <li style="background-image: url(http://test.miaov.com/h5/1-3/img/d.png); background-position: 0px 0px;">
        	<div></div>
        </li>
        <li style="background-image: url(http://test.miaov.com/h5/1-3/img/e.png); background-position: 0px 0px;">
        	<div style="left:27px;top:15%;">transform &nbsp;transition &nbsp;rotate &nbsp;scale &nbsp;translate &nbsp;keyframes animation &nbsp;webkitTransitionEnd webkitAnimationIteration elapsedTime perspective…</div>
            <div style="left:312px;top:19%;">drawImage lineWidth &nbsp;strokeStyle &nbsp;lineCap &nbsp;globalCompositeOperation &nbsp;moveTo &nbsp; lineTo &nbsp;stroke &nbsp;arc &nbsp;getImageData…</div>
            <div style="left:523px;top:45%;">audio autoplay loop &nbsp;paused &nbsp;play &nbsp;pause…</div>
            <div style="left:329px;top:80%;">viewport &nbsp;touchstart &nbsp;touchmove &nbsp;touchend &nbsp;changedTouches…</div>
            <div style="left:60px;top:73%;">on() off() &nbsp;css() &nbsp;eq() siblings() &nbsp;show() &nbsp; hide() &nbsp;find() trigger()remove() &nbsp;animate() originalEv...</div>
        </li>
        <li style="background-image: url(http://test.miaov.com/h5/1-3/img/ad1.png); background-position: 0px 0px;"></li>
        <li style="background-image: url(http://test.miaov.com/h5/1-3/img/ad2.png); background-position: 0px 0px;"></li>
        <li style="background-image: url(http://test.miaov.com/h5/1-3/img/ad3.png); background-position: 0px 0px;"></li>
        <li style="background-image: url(http://test.miaov.com/h5/1-3/img/ad4.png); background-position: 0px 0px;"></li>
    </ul>
    <div id="arrow"></div>
    <div id="music">
    	<audio loop="" src="img/music.mp3" preload="" style="display:none;"></audio>
    </div>
</div>


</body></html>